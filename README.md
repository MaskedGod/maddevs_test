# FastAPI API для управления пациентами

Этот проект реализует простой API-сервер на FastAPI для управления пациентами. Он предоставляет два основных эндпоинта: `/login` для получения JWT-токена и `/patients` для получения данных о пациентах для пользователей с ролью "doctor" (врач).

## Функциональные возможности

- Аутентификация пользователей с использованием JWT-токенов
- Два основных эндпоинта:
  - `/login`: Вход пользователя и получение токена
  - `/patients`: Получение данных о пациентах (только для пользователей с ролью "doctor")
- Контроль доступа на основе ролей
- Развертывание в Docker
- База данных SQLite для демонстрации

## Структура репозитория

1. **tests** — Папка с тестами
   - `conftest.py` — Фикстуры и настройки тестов
   - `test_main.py` — Тесты для основных эндпоинтов
2. **code** — Исходный код
   - `main.py` — Основной файл приложения FastAPI
   - `models.py` — SQLAlchemy модели для пользователей и пациентов
   - `schemas.py` — Pydantic схемы
   - `utils/` — Вспомогательные модули для безопасности, аутентификации, базы данных
3. **docker** — Dockerfile и docker-compose.yaml
4. **migrations** — Файлы миграций для базы данных
5. **README.md** — Документация

## Как запустить проект локально

### Шаги:

1. **Клонируйте репозиторий**:

   ```bash
   git clone https://github.com/MaskedGod/maddevs_test
   cd my_fastapi_app
   ```

2. **Создайте и активируйте виртуальное окружение (опционально)**:

   ```bash
   python3 -m venv venv
   source venv/bin/activate  # для Linux/Mac
   venv\Scripts\activate     # для Windows
   ```

3. **Установите зависимости**:

   ```bash
   pip install -r requirements.txt
   ```

4. **Примените миграции Alembic**:
   Если вы не используете Docker, для создания таблиц в базе данных необходимо применить миграции Alembic. Выполните следующие команды:

   ```bash
   alembic upgrade head
   ```

5. **Запустите проект**:
   Если вы не используете Docker, можно запустить проект с помощью Uvicorn:

   ```bash
   uvicorn code.main:app --reload
   ```

6. **Использование Docker**:

   - Соберите и запустите контейнеры через `docker-compose`:
     ```bash
     cd docker
     docker-compose up --build
     ```

7. **Заполните базу данных тестовыми данными (опционально)**:
   Запустите скрипт `seed.py` для создания тестовых пользователей и пациентов:
   ```bash
   python code/seed.py
   ```

### Примеры запросов

- **/login**: POST запрос для аутентификации пользователя и получения JWT токена.

  ```bash
  curl -X POST "http://localhost:8000/login" -d "username=doctor1&password=hashed_password1"
  ```

- **/patients**: GET запрос для получения списка пациентов (только для пользователей с ролью "doctor").
  ```bash
  curl -H "Authorization: Bearer <your_token>" "http://localhost:8000/patients"
  ```

## Тестирование

Тесты находятся в папке `tests`. Для запуска тестов выполните:

```bash
pytest --cov=code
```

---

Требования

1. Написать API-сервер (фреймворк по желанию - FastAPI / Django / Flask)
2. Сервер должен иметь 2 эндпоинта
   2.1. `/login`
   2.2. `/patients` c JWT-авторизацией пользователей
3. `/login` должен отдавать jwt-token по логину и паролю
4. `/patients` должен вернуть список пациентов из БД только для пользователей с ролью `doctor`
5. Схема данных для `/patients` -> `list[Patient]` (Описание `Patient` ниже)
6. Код должен быть снабжён комментариями и README (по шаблону) с инструкциями по поднятию сервера и отправке запросов
7. Код должен быть запушен в git-репозиторий (github, gitlab, bitbucket - любой на выбор). Желательно с коммитами по ходу написания кода
8. Код должен быть оттестирован с покрытием выше 80%
9. Инструмент управления зависимостей на свой выбор
10. Код должен запускаться в докер-контейнере

# Схема Patient

```python
class Patient(TypedDict):
    id: int
    # дата рождения
    date_of_birth: date
    # массив строк с названиями диагнозов
    diagnoses: list[str]
    # дата создания записи
    created_at: datetime
```

# Шаблон README

## Структура репозитория

1. `tests` = <Название папки с тестами>
2. `code` = <Название папки с кодом>
3. `docker` = <Название `dockerfile` или `docker-compose.yaml`>
4. `migrations` = <Название и путь до файлов миграций в БД>

## Инструкции по локальному запуску

...
